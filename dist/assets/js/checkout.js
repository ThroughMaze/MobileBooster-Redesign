import"./bootstrap.js";/* empty css     */import"./bootstrap.min.js";class u{constructor(){this.shippingCosts={free_shipping:0,standard_shipping:9.99,express_shipping:19.99},this.init()}init(){this.bindEvents(),this.updateOrderSummary(),this.initFormValidation(),this.initPaymentMethods()}bindEvents(){const e=document.getElementById("ship_to_different_address");e&&e.addEventListener("change",n=>this.toggleShippingAddress(n)),document.querySelectorAll('input[name="shipping_method"]').forEach(n=>{n.addEventListener("change",()=>this.updateShippingCost())}),document.querySelectorAll('input[name="payment_method"]').forEach(n=>{n.addEventListener("change",l=>this.togglePaymentFields(l))});const t=document.getElementById("checkout-form");t&&t.addEventListener("submit",n=>this.handleFormSubmission(n));const s=document.getElementById("card_number");s&&s.addEventListener("input",n=>this.formatCardNumber(n));const i=document.getElementById("card_expiry");i&&i.addEventListener("input",n=>this.formatExpiryDate(n));const a=document.getElementById("card_cvc");a&&a.addEventListener("input",n=>this.formatCvc(n)),this.setupAddressAutofill()}toggleShippingAddress(e){const t=document.getElementById("shipping-fields"),s=t.querySelectorAll("input, select");e.target.checked?(t.classList.remove("d-none"),s.forEach(i=>{(i.name.includes("first_name")||i.name.includes("last_name")||i.name.includes("address_1")||i.name.includes("city")||i.name.includes("postcode")||i.name.includes("country"))&&(i.required=!0)})):(t.classList.add("d-none"),s.forEach(i=>{i.required=!1}))}updateShippingCost(){const e=document.querySelector('input[name="shipping_method"]:checked');if(!e)return;const t=this.shippingCosts[e.value],s=document.querySelector(".shipping-cost");s&&(s.textContent=t===0?"Free":`£${t.toFixed(2)}`),this.updateOrderTotal()}updateOrderTotal(){const e=document.querySelector(".subtotal"),t=document.querySelector(".vat"),s=document.querySelector(".shipping-cost"),i=document.querySelector(".total");if(!e||!t||!s||!i)return;const a=parseFloat(e.textContent.replace("£","")),n=document.querySelector('input[name="shipping_method"]:checked'),l=n?this.shippingCosts[n.value]:0,d=a*.2,c=a+l+d;t.textContent=`£${d.toFixed(2)}`,i.textContent=`£${c.toFixed(2)}`}togglePaymentFields(e){const t=document.getElementById("card-details"),s=t.querySelectorAll("input");e.target.value==="stripe"?(t.style.display="block",s.forEach(i=>i.required=!0)):(t.style.display="none",s.forEach(i=>i.required=!1))}formatCardNumber(e){var i;let t=e.target.value.replace(/\s/g,"").replace(/[^0-9]/gi,""),s=((i=t.match(/.{1,4}/g))==null?void 0:i.join(" "))||t;s.length>19&&(s=s.substring(0,19)),e.target.value=s}formatExpiryDate(e){let t=e.target.value.replace(/\D/g,"");t.length>=2&&(t=t.substring(0,2)+"/"+t.substring(2,4)),e.target.value=t}formatCvc(e){let t=e.target.value.replace(/\D/g,"");e.target.value=t.substring(0,4)}setupAddressAutofill(){["billing_first_name","billing_last_name","billing_company","billing_address_1","billing_address_2","billing_city","billing_state","billing_postcode","billing_country"].forEach(t=>{const s=document.getElementById(t);s&&s.addEventListener("blur",()=>this.autofillShipping())})}autofillShipping(){const e=document.getElementById("ship_to_different_address");if(e&&e.checked)return;Object.entries({billing_first_name:"shipping_first_name",billing_last_name:"shipping_last_name",billing_company:"shipping_company",billing_address_1:"shipping_address_1",billing_address_2:"shipping_address_2",billing_city:"shipping_city",billing_state:"shipping_state",billing_postcode:"shipping_postcode",billing_country:"shipping_country"}).forEach(([s,i])=>{const a=document.getElementById(s),n=document.getElementById(i);a&&n&&(n.value=a.value)})}async handleFormSubmission(e){e.preventDefault();const t=e.target,s=document.getElementById("place-order-btn"),i=s.querySelector(".spinner-border");if(!t.checkValidity()){t.classList.add("was-validated");return}s.disabled=!0,i.classList.remove("d-none"),s.innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Processing...';try{await this.processOrder(new FormData(t)),this.showSuccessMessage(),setTimeout(()=>{window.location.href="/order-confirmation.html"},2e3)}catch(a){this.showErrorMessage(a.message)}finally{s.disabled=!1,i.classList.add("d-none"),s.innerHTML="Place Order"}}async processOrder(e){if(await new Promise(t=>setTimeout(t,2e3)),Math.random()>.1)return{success:!0,orderId:"ORD-"+Date.now()};throw new Error("Payment processing failed. Please try again.")}showSuccessMessage(){this.showMessage("Order placed successfully! Redirecting...","success")}showErrorMessage(e){this.showMessage(e,"error")}showMessage(e,t){const s=document.createElement("div");s.className=`alert alert-${t==="success"?"success":"danger"} position-fixed`,s.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",s.textContent=e,document.body.appendChild(s),setTimeout(()=>{s.remove()},5e3)}updateOrderSummary(){const e=localStorage.getItem("cart");if(e){const t=JSON.parse(e);this.displayOrderItems(t)}this.updateOrderTotal()}displayOrderItems(e){}initFormValidation(){const e=document.querySelectorAll(".needs-validation");Array.from(e).forEach(t=>{t.addEventListener("submit",s=>{t.checkValidity()||(s.preventDefault(),s.stopPropagation()),t.classList.add("was-validated")},!1)}),this.initCardValidation()}initCardValidation(){const e=document.getElementById("card_number"),t=document.getElementById("card_expiry"),s=document.getElementById("card_cvc");e&&e.addEventListener("blur",()=>this.validateCardNumber(e)),t&&t.addEventListener("blur",()=>this.validateExpiryDate(t)),s&&s.addEventListener("blur",()=>this.validateCvc(s))}validateCardNumber(e){const t=e.value.replace(/\s/g,""),s=/^[0-9]{13,19}$/.test(t)&&this.luhnCheck(t);return s?(e.classList.remove("is-invalid"),e.classList.add("is-valid")):(e.classList.remove("is-valid"),e.classList.add("is-invalid")),s}validateExpiryDate(e){const t=e.value,[s,i]=t.split("/"),a=new Date,n=a.getFullYear()%100,l=a.getMonth()+1,d=/^(0[1-9]|1[0-2])\/[0-9]{2}$/.test(t)&&(parseInt(i)>n||parseInt(i)===n&&parseInt(s)>=l);return d?(e.classList.remove("is-invalid"),e.classList.add("is-valid")):(e.classList.remove("is-valid"),e.classList.add("is-invalid")),d}validateCvc(e){const t=e.value,s=/^[0-9]{3,4}$/.test(t);return s?(e.classList.remove("is-invalid"),e.classList.add("is-valid")):(e.classList.remove("is-valid"),e.classList.add("is-invalid")),s}luhnCheck(e){let t=0,s=!1;for(let i=e.length-1;i>=0;i--){let a=parseInt(e.charAt(i));s&&(a*=2,a>9&&(a-=9)),t+=a,s=!s}return t%10===0}initPaymentMethods(){const e=document.getElementById("stripe");e&&e.checked&&this.togglePaymentFields({target:e})}}document.addEventListener("DOMContentLoaded",()=>{new u});document.addEventListener("DOMContentLoaded",()=>{const r=document.querySelector('[data-bs-toggle="collapse"]'),e=document.querySelector(".fullscreen-nav");r&&e&&r.addEventListener("click",()=>{r.classList.toggle("active"),e.classList.toggle("active")})});document.querySelectorAll(".country-item").forEach(r=>{r.addEventListener("click",e=>{const t=e.currentTarget.querySelector("input[type=radio]"),s=e.currentTarget.querySelector("img"),i=document.querySelector("#openPopup img");t&&t.checked&&s&&i?i.src=s.src:i&&(i.src="https://flagcdn.com/gb.svg")})});var o;(o=document.querySelector(".subscribe-form"))==null||o.addEventListener("submit",r=>{r.preventDefault(),r.currentTarget.checkValidity()&&r.currentTarget.classList.add("subscribed")});
